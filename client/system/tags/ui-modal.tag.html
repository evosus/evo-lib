<ui-modal>
	<div if="{ opts.isOpen && opts.template }" class="ui-modal f-col ai-center jc-center fill">
		<div class="ui-white rounded modal-shadow">
			<div class="modal-contents">
				<div id="modalMount">
					<div class="pad-1 fg-grey-lt">
						Loading...
					</div>
				</div>	
			</div>	
		</div>
	</div>
	<style>
		.modal-close { cursor:pointer; }
		.modal-close i { color:grey;transition:.2s ease-in-out all; }
		.modal-close:hover i { color:red; }
		.ui-modal {
			position:absolute;
			z-index:9800;	
			width:100vw;
			height:100vh;
			background:transparent;
			transition:.2s ease-in-out all;
		}
		.ui-modal.fill { background:rgba(0,0,0,0.5); }
		.modal-shadow {
			overflow:hidden;
			box-shadow:0px 10px 60px 10px rgba(0,0,0,0.5);
		}
	</style>
	<script>
		this.mixin(IO.default);
		this.on('update',() => {
			console.log('update', this.opts);
			
			if(this.opts.template && this.opts.templateOpts) {
				riot.mount('#modalMount',this.opts.template,this.opts.templateOpts || {});	
			}
		});
		// this.on('updated',() => {
		// 	console.log(this.opts)
		// 	if (this.opts.isOpen) {
		// 		console.log('isOpen', this.opts.templateOpts)
		// 		// console.log()
		// 	}			
		// })
		this.on('before-mount', (e) => {
			let navState = IO.default.getStateByKey('NAV')
			if (navState.ui_modal.isOpen) {
				console.log('modal is open')
				IO.default.obs.trigger('CLOSE_MODAL')
				this.update()
			}
		})
		// this.on('mount', () => {
			// IO.default.obs.trigger('CLOSE_MODAL');
			// if (this.opts) {
			// 	console.log('mount', this.opts)
			// 	// IO.default.obs.trigger('CLOSE_MODAL')
			// }
			// try {
			// } catch (e) {
			// 	console.log('before-mount', this.opts)
			// }
		// })
	</script>
</ui-modal>
