<!--
FORM CHECKBOX
!-->
<form-checkbox onclick="{ check }" checked="{ isChecked }" check="{ check }">
	<div class="checkbox-label">
		<span>{ opts.label }</span>
	</div>
	<div class="checkbox">
		<div class="checkbox-icon f-col ai-center jc-center">
			<i class="{ mdi:true, mdi-checkbox-marked: isChecked, mdi-checkbox-blank-outline: !isChecked }"></i>
		</div>
		<div class="checkbox-msg">
			<span if="{ isChecked }">{ opts.positive }</span>
			<span if="{ !isChecked }">{ opts.negative }</span>
		</div>
	</div>
	<div class="checkbox-message"></div>
	<script>
		var self = this;
		isChecked = false;
		check() { isChecked ? opts.io.trigger(opts.name + ':uncheck') : opts.io.trigger(opts.name + ':check'); }
		opts.io.on(opts.name + ':check',function() { isChecked = true; self.update(); });
		opts.io.on(opts.name + ':uncheck',function() { isChecked = false; self.update(); });
	</script>
</form-checkbox>
<!--
FORM INPUT
!-->
<form-input value="{ field.value }"
	class="input {
		locked:opts.css == 'locked',
		touched:field.value.length && !isFocused,
		focus:isFocused,
		valid:isValid,
		invalid:isInvalid,
		invalid-focus:isFocused && isInvalid
	}">
	<div class="input-label">
		<span>{ opts.label }</span>
		<i if="{ isTouched }" class="{ mdi:1, mdi-check:isValid, mdi-block-helper:isInvalid }"></i>
	</div>
	<div class="input-stack f-row">
		<div class="input-row f-row ai-center">
			<input name="field"
				class="f-one"
				type="{ opts.type || 'text' }"
				placeholder="{ opts.placeholder }"
				onfocus="{ focus }"
				onblur="{ blur }"
				onchange="{ change }"
				onkeyup="{ keyup }"
			/>
			<i class="mdi { mdi-check:isValid,mdi-alert-circle-outline:isInvalid,mdi-pencil:isFocused && !isInvalid && !isValid }"></i>
		</div>
		<div class="input-fill"></div>
	</div>
	<div class="input-message fg-failure">
		<span if="{ msg }" >{ msg }</span>
	</div>
	<script>
		var self = this;
		isBlurred = null;isFocused = null;isValid = null;isInvalid = null;isLocked = null;
		// --------------------------------------
		// ON MOUNT
		// --------------------------------------
		this.on('mount',function() {
			if(opts.value) { 
				opts.io.trigger(opts.name + ':change',opts.value);
			}
		});
		// --------------------------------------
		// MAP EVENTS TO OBSERVABLE (io)
		// --------------------------------------
		blur(e) { opts.io.trigger(opts.name + ':blur',e); }
		change(e) { opts.io.trigger(opts.name + ':change',e); }
		click(e) { opts.io.trigger(opts.name + ':click',e); }
		focus(e) { opts.io.trigger(opts.name + ':focus',e); }
		hover(e) { opts.io.trigger(opts.name + ':hover',e); }
		keyup(e) { opts.io.trigger(opts.name + ':keyup',e); }
		// --------------------------------------
		// ON BLUR
		// --------------------------------------
		opts.io.on(opts.name + ':blur',function() {
			self.isFocused = null;
			self.update();
		});
		// --------------------------------------
		// ON FOCUS
		// --------------------------------------
		opts.io.on(opts.name + ':focus',function(e) {
			self.field.focus();
			self.isFocused = true;
			self.update();
		});
		// --------------------------------------
		// ON CHANGE
		// --------------------------------------
		opts.io.on(opts.name + ':change',function(e) {
			if(e.target.value) {
				self.field.value = e.target.value;
				self.update();
			}
		});
		// --------------------------------------
		// ON INVALID
		// --------------------------------------
		opts.io.on(opts.name + ':invalid',function(msg) {
			if(msg || self.msg) { self.msg = msg; } else { self.msg == null }
			self.isValid = false;
			self.isInvalid = true;
			self.update();
		});
		// --------------------------------------
		// ON VALID
		// --------------------------------------
		opts.io.on(opts.name + ':valid',function(msg) {
			if(msg || self.msg) { self.msg = msg; } else { self.msg == null }
			self.isValid = true;
			self.isInvalid = false;
			self.update();
		});
		// --------------------------------------
		// ON RESET
		// --------------------------------------
		opts.io.on(opts.name + ':reset',function(msg) {
			if(msg || self.msg) { self.msg = msg; } else { self.msg == null }
			self.field.value = '';
			self.isBlurred = null;
			self.isFocused = null;
			self.isValid = null;
			self.isInvalid = null;
			self.isLocked = null;
			self.update();
		});
	</script>
</form-input>
<!--
FORM SELECT
!-->
<form-select idx="{ this.htmlselect.selectedIndex }">
	<div class="select-label">
		<span>{ opts.label }</span>
	</div>
	<div class="select f-row ai-center { opts.css }">
		<div if="{ opts.mdicon }" class="input-icon f-col ai-center jc-center"><i class="{ opts.mdicon } fg-gray-dk"></i></div>
		<select id="htmlselect" value="{ selected }" onchange="{ change }" onfocus="{ focus }" onblur="{ blur }">
			<option each="{ opts.options }" selected="{ index == selected }">{ label }</option>
		</select>
		<i class="mdi mdi-chevron-down"></i>
		<div class="select-fill"></div>
	</div>
	<div class="select-message"></div>
	<script>
		var self = this;
		isOpen = false;
		this.on('mount',function() {
			// --------------------------------------
			// SET Selected Item
			// --------------------------------------
			if(!opts.selection) {
				this.htmlselect.selectedIndex = 0;
					if(opts.options[0].mdicon) { mdicon = opts.options[0].mdicon; }
					if(opts.options[0].svgclass) { mdicon = opts.options[0].svgclass; }
			} else {
				var len = opts.options.length;
				for(i = 0; i < len; i++) {
					if(opts.options[i].label == opts.selection) {
						this.htmlselect.selectedIndex = i;
						if(opts.options[i].mdicon) { mdicon = opts.options[i].mdicon; }
						if(opts.options[i].svgclass) { mdicon = opts.options[i].svgclass; }
					}
				}
			}
		});
		blur() { isFocused = false;self.update(); }
		focus() { isOpen = true;self.update(); }
		change(e) {
			isOpen = false;
			opts.io.trigger(opts.name + ':change',e);
			htmlselect.blur();
			self.update();
		}
	</script>
</form-select>
