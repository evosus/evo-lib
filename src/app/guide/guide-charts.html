<guide-charts>
	<ui-bar css="ui-primary-lt jc-between ui-bar-shadow">
		<ui-bar-left>
			<ui-btn-icon name="home_icon" mdicon="mdi mdi-chart-pie" css="ui-primary-lt" io="{ ui }" />
			<ui-bar-title value="Charts" />
		</ui-bar-left>
		<ui-bar-right>
			<ui-btn-icon name="reset_pie" mdicon="mdi mdi-refresh" css="ui-primary-lt" io="{ ui }" />
		</ui-bar-right>
	</ui-bar>
	<ui-scroll-2>
		<ui-container css="shadow-box ui-white pad-1-2">
			<ui-layout-title value="D3 Pie Chart" />
			<div class="f-row ai-center jc-center">
				<div id="chart"></div>
			</div>
		</ui-container>
	</ui-scroll-2>
	<script>
		this.on('mount',function() {
			// --------------------------------------
			// D3
			// --------------------------------------
			(function(d3) {
				'use strict';
				// --------------------------------------
				// D3 DATA
				// --------------------------------------
        var dataset = [
          { label: 'AAA', count: 40 },
          { label: 'BBB', count: 30 },
          { label: 'CCC', count: 20 },
          { label: 'DDD', count: 10 }
        ];
				// --------------------------------------
				// D3 DIMENSIONS
				// --------------------------------------
        var width = 250;
        var height = 250;
        var radius = Math.min(width, height) / 2;
        var color = d3.scaleOrdinal(d3.schemeCategory20b);
				// --------------------------------------
				// D3 SVG
				// --------------------------------------
        var svg = d3.select('#chart')
          .append('svg')
          .attr('width', width)
          .attr('height', height)
          .append('g')
          .attr('transform', 'translate(' + (width / 2) +
            ',' + (height / 2) + ')');
				// --------------------------------------
				// D3 ARC
				// --------------------------------------
        var arc = d3.arc()
          .innerRadius(0)
          .outerRadius(radius);
				// --------------------------------------
				// D3 PIE
				// --------------------------------------
        var pie = d3.pie()
          .value(function(d) { return d.count; })
          .sort(null);
				// --------------------------------------
				// D3 LABEL ARC
				// --------------------------------------
				var labelArc = d3.arc()
					.outerRadius(radius - 40)
					.innerRadius(radius - 40);
				// --------------------------------------
				// D3 PATH
				// --------------------------------------
        var path = svg.selectAll('path')
          .data(pie(dataset))
          .enter()
          .append('path')
          .attr('d', arc)
          .attr('fill', function(d) {
            return color(d.data.label);
          })
				// --------------------------------------
				// D3 ADD DATA
				// --------------------------------------
				var g = svg.selectAll(".arc")
					.data(pie(dataset))
					.enter().append("g")
					.attr("class", "arc");
				// --------------------------------------
				// D3 ADD TEXT
				// --------------------------------------
				g.append("text")
					.attr("transform", function(d) { return "translate(" + labelArc.centroid(d) + ")"; })
					.attr("dy", ".35em")
					.attr("fill","#ffffff")
					.text(function(d) { return d.data.label });
				// --------------------------------------
				// D3 CLICK
				// --------------------------------------
/*
				path.on('click', function(e) {
					var clicked = d3.selectAll("text").filter(function(d,i) { return i === e.index });
					clicked.text("$$$");
				});
*/
				// --------------------------------------
				// D3 MOUSEUP
				// --------------------------------------
				path.on('mouseup', function(e) {
					var clicked = d3.selectAll("text").filter(function(d,i) { return i === e.index });
					clicked.text("***");
				});
				// --------------------------------------
				// D3 MOUSEOVER
				// --------------------------------------
				path.on('mouseover', function(e) {
					// BACKGROUND COLOR	
					d3.select(this).attr("fill","#aaaaaa");
					// TEXT COLOR	
					d3.selectAll("text").filter(function(d,i) { return i === e.index }).style("fill",function(d) { return color(d.data.label); });
				});
				// --------------------------------------
				// D3 MOUSEOUT
				// --------------------------------------
				path.on('mouseout', function(e) {
					// BACKGROUND COLOR	
					d3.select(this).attr('fill', function(d) { return color(d.data.label); });
					// TEXT COLOR	
					d3.selectAll("text").filter(function(d,i) { return i === e.index }).style("fill","white");
				});
      })(window.d3);
			// --------------------------------------
			// D3 LABEL RESET
			// --------------------------------------
			ui.on('reset_pie:click',function() {
				var tst = d3.select("#chart").selectAll("text")
					.text(function(d) { return d.data.label; });
			});
		});
	</script>
</guide-charts>
